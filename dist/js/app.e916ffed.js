(function(){"use strict";var t={1503:function(t,e,s){var a=s(9242),n=s(3396);const o={class:"container-fluid container-md"};function i(t,e){const s=(0,n.up)("router-view");return(0,n.wg)(),(0,n.iD)("div",o,[(0,n.Wm)(s)])}var l=s(89);const r={},u=(0,l.Z)(r,[["render",i]]);var d=u,c=s(678),h=s(65),p=(0,h.MT)({state:{orgJWT:"",emplJWT:"",isAffiliate:!1},mutations:{setOrgJWT(t,e){t.orgJWT=e},setEmplJWT(t,e){t.emplJWT=e},setAffiliate(t,e){t.isAffiliate=e}}});const m={class:"auth d-flex flex-wrap justify-content-center"},f=(0,n._)("h1",{class:"col-12 text-center p-2"},"7Era POS System",-1),_={class:"col col-md-4 mt-3 p-4 bg-white"},w={class:"row mt-3"},b={class:"row mt-3"},g={class:"row mt-3"},v={class:"row mt-3"};function S(t,e,s,o,i,l){return(0,n.wg)(),(0,n.iD)("div",m,[f,(0,n._)("form",_,[(0,n._)("div",w,[(0,n.wy)((0,n._)("input",{name:"email",type:"text",class:"form-control",placeholder:"Е-мейл","onUpdate:modelValue":e[0]||(e[0]=e=>t.email=e)},null,512),[[a.nr,t.email]])]),(0,n._)("div",b,[(0,n.wy)((0,n._)("input",{name:"org_password",type:"password",class:"form-control",placeholder:"Пароль организации","onUpdate:modelValue":e[1]||(e[1]=e=>t.password=e)},null,512),[[a.nr,t.password]])]),(0,n._)("div",g,[(0,n.wy)((0,n._)("input",{autocomplete:"false",name:"owner_pin",type:"password",class:"form-control",placeholder:"PIN владельца","onUpdate:modelValue":e[2]||(e[2]=e=>t.pin=e)},null,512),[[a.nr,t.pin]])]),(0,n._)("div",v,[(0,n._)("button",{class:"btn btn-primary",onClick:e[3]||(e[3]=(0,a.iM)(((...t)=>l.signIn&&l.signIn(...t)),["prevent"]))}," Вход ")])])])}var y=s(6265),O=s.n(y),$=O();$.defaults.baseURL="http://141.8.199.108/api/v1";var k=$,T={name:"AuthView",data:()=>({email:"",password:"",pin:""}),methods:{async signIn(){let t;try{let t=await k({url:"/auth/signIn.Org",method:"post",data:{email:this.$data.email,password:this.$data.password}});this.$store.commit("setOrgJWT",t.data.data.token)}catch{return void alert("неверные данные для входа")}try{let e=await k({url:"/employees",method:"get",headers:{Authorization:this.$store.state.orgJWT},data:{email:this.$data.email,password:this.$data.password}});for(let s=0;s<e.data.data.length;s++)if("owner"===e.data.data[s]["role"]){t=e.data.data[s]["id"];break}}catch{return void alert("ошибка получения списка сотрудников")}try{let e=await k({url:"/auth/signIn.Employee",method:"post",headers:{Authorization:this.$store.state.orgJWT},data:{id:t,password:this.$data.pin}});this.$store.commit("setEmplJWT",e.data.data.token),this.$store.commit("setAffiliate",e.data.data.affiliate),console.info("success auth!")}catch{return void alert("ошибка при входе в аккаунт владельца")}this.$router.push({name:"report"})}}};const x=(0,l.Z)(T,[["render",S]]);var W=x,z=s(7139);const J={class:"report d-flex flex-column"},U={class:"col d-flex justify-content-between bg-white p-2 m-1 m-md-3"},L=["value"],A=(0,n._)("i",{class:"bi bi-arrow-repeat"},null,-1),D=[A],j={class:"col d-flex flex-wrap bg-white p-2 m-1 m-md-3"},I=(0,n._)("h6",{class:"col-12 text-center"},"Метрики по последней смене",-1),P={class:"col d-flex flex-column"},C=(0,n._)("i",{class:"bi bi-person-fill"},null,-1),E=(0,n.Uk)(" ID сотрудника: "),M=(0,n._)("i",{class:"bi bi-bar-chart-line"},null,-1),V=(0,n.Uk)(" Статус смены: "),B=(0,n._)("hr",null,null,-1),R=(0,n._)("i",{class:"bi bi-door-open"},null,-1),H=(0,n._)("i",{class:"bi bi-door-closed"},null,-1),Z=(0,n._)("hr",null,null,-1),F=(0,n._)("i",{class:"bi bi-cash-coin"},null,-1),K=(0,n._)("i",{class:"bi bi-cash-coin"},null,-1),N=(0,n._)("hr",null,null,-1),Y=(0,n._)("i",{class:"bi bi-cart-check"},null,-1),q=(0,n.Uk)(" Кол-во чеков: "),G=(0,n._)("i",{class:"bi bi-piggy-bank"},null,-1),Q=(0,n.Uk)(" Выручка: ");function X(t,e,s,o,i,l){return(0,n.wg)(),(0,n.iD)("div",J,[(0,n._)("div",U,[(0,n.wy)((0,n._)("select",{class:"col-5 p-2",name:"outlets","onUpdate:modelValue":e[0]||(e[0]=e=>t.selectedOutlet=e),onChange:e[1]||(e[1]=(...t)=>l.changeOutlet&&l.changeOutlet(...t))},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(t.outlets,((t,e)=>((0,n.wg)(),(0,n.iD)("option",{key:e,value:t.id},(0,z.zw)(t.name),9,L)))),128))],544),[[a.bM,t.selectedOutlet,void 0,{number:!0}]]),(0,n._)("button",{class:"btn btn-outline-dark",onClick:e[2]||(e[2]=(...t)=>l.reportOnLastSession&&l.reportOnLastSession(...t))},D)]),(0,n._)("div",j,[I,(0,n._)("div",P,[(0,n._)("span",null,[C,E,(0,n._)("b",null,(0,z.zw)(t.lastSession.employee_id),1)]),(0,n._)("span",null,[M,V,(0,n._)("b",null,(0,z.zw)("-"===t.lastSession.date_close?"открыта":"закрыта"),1)]),B,(0,n._)("span",null,[R,(0,n.Uk)(" Открыта: "+(0,z.zw)(t.lastSession.date_open),1)]),(0,n._)("span",null,[H,(0,n.Uk)(" Закрыта: "+(0,z.zw)(t.lastSession.date_close),1)]),Z,(0,n._)("span",null,[F,(0,n.Uk)(" Наличные на момент открытия кассы: "+(0,z.zw)(t.lastSession.cash_open),1)]),(0,n._)("span",null,[K,(0,n.Uk)(" Наличные на момент закрытия кассы: "+(0,z.zw)(t.lastSession.cash_close),1)]),N,(0,n._)("span",null,[Y,q,(0,n._)("b",null,(0,z.zw)(t.lastSession.number_of_receipts),1)]),(0,n._)("span",null,[G,Q,(0,n._)("b",null,(0,z.zw)((t.lastSession.cash_earned+t.lastSession.bank_earned).toFixed(2))+" ₽ ",1)])])])])}var tt={name:"ReportView",data:()=>({reloadKey:!1,selectedOutlet:0,outlets:[{id:0,name:"Загрузка..."}],lastSession:{id:0,cash_earned:0,bank_earned:0,number_of_receipts:0,cash_open:0,cash_close:0,date_open:0,date_close:0,employee_id:0,outlet_id:0}}),mounted(){this.loadOutlets(),this.reportOnLastSession()},watch:{lastSession:function(t){let e;this.lastSession=t,0===this.lastSession.date_open?this.lastSession.date_open="-":(e=new Date(this.lastSession.date_open),this.lastSession.date_open=`${e.toDateString()} ${e.getHours()}:${e.getMinutes()}`),0===this.lastSession.date_close?this.lastSession.date_close="-":(e=new Date(this.lastSession.date_close),this.lastSession.date_close=`${e.toDateString()} ${e.getHours()}:${e.getMinutes()}`)}},methods:{changeOutlet(){this.reportOnLastSession()},loadOutlets(){k({url:"/outlets",method:"get",headers:{Authorization:this.$store.state.orgJWT}}).then((t=>{this.$data.outlets=t.data.data,this.$data.selectedOutlet=t.data.data[0].id}))},reportOnLastSession(){k({url:"/sessions.Last",params:{outlet_id:this.$data.selectedOutlet},method:"get",headers:{Authorization:this.$store.state.emplJWT}}).then((t=>{this.$data.lastSession=t.data.data,0===this.$data.lastSession.date_close&&0!=this.$data.lastSession.date_open&&(this.calculateReceiptsByLastSession(),this.calculateProfitByLastSession())}))},calculateReceiptsByLastSession(){k({url:"/orderInfo",params:{session_id:this.$data.lastSession.id},method:"get",headers:{Authorization:this.$store.state.emplJWT}}).then((t=>{this.$data.lastSession.number_of_receipts=t.data.data.length}))},calculateProfitByLastSession(){k({url:"/orderList.Calc",params:{session_id:this.$data.lastSession.id},method:"get",headers:{Authorization:this.$store.state.emplJWT}}).then((t=>{this.$data.lastSession.bank_earned=t.data.data.total}))}}};const et=(0,l.Z)(tt,[["render",X]]);var st=et;const at=[{path:"/",name:"auth",component:W},{path:"/report",name:"report",component:st}],nt=(0,c.p7)({history:(0,c.PO)("/"),routes:at});nt.beforeEach((t=>{if("/"!=t.fullPath&&""===p.state.emplJWT)return nt.push({name:"auth"})}));var ot=nt;(0,a.ri)(d).use(p).use(ot).mount("#app")}},e={};function s(a){var n=e[a];if(void 0!==n)return n.exports;var o=e[a]={exports:{}};return t[a](o,o.exports,s),o.exports}s.m=t,function(){var t=[];s.O=function(e,a,n,o){if(!a){var i=1/0;for(d=0;d<t.length;d++){a=t[d][0],n=t[d][1],o=t[d][2];for(var l=!0,r=0;r<a.length;r++)(!1&o||i>=o)&&Object.keys(s.O).every((function(t){return s.O[t](a[r])}))?a.splice(r--,1):(l=!1,o<i&&(i=o));if(l){t.splice(d--,1);var u=n();void 0!==u&&(e=u)}}return e}o=o||0;for(var d=t.length;d>0&&t[d-1][2]>o;d--)t[d]=t[d-1];t[d]=[a,n,o]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={143:0};s.O.j=function(e){return 0===t[e]};var e=function(e,a){var n,o,i=a[0],l=a[1],r=a[2],u=0;if(i.some((function(e){return 0!==t[e]}))){for(n in l)s.o(l,n)&&(s.m[n]=l[n]);if(r)var d=r(s)}for(e&&e(a);u<i.length;u++)o=i[u],s.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return s.O(d)},a=self["webpackChunk_7era_pos_webpanel"]=self["webpackChunk_7era_pos_webpanel"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=s.O(void 0,[998],(function(){return s(1503)}));a=s.O(a)})();
//# sourceMappingURL=app.e916ffed.js.map