(function(){"use strict";var t={3812:function(t,e,s){var a=s(9242),o=s(3396);const n={class:"container-fluid container-md"};function l(t,e){const s=(0,o.up)("router-view");return(0,o.wg)(),(0,o.iD)("div",n,[(0,o.Wm)(s)])}var i=s(89);const r={},u=(0,i.Z)(r,[["render",l]]);var d=u,c=s(678),p=s(65),h=(0,p.MT)({state:{orgJWT:"",emplJWT:"",isAffiliate:!1,outlets:[{id:0,name:"loading..."}],employees:[]},mutations:{setOrgJWT(t,e){t.orgJWT=e},setEmplJWT(t,e){t.emplJWT=e},setAffiliate(t,e){t.isAffiliate=e},setOutlets(t,e){t.outlets=e},setEmployees(t,e){t.employees=e}},getters:{getEmployeeByID(t){return e=>{for(let s=0;s<t.employees.length;s++)if(t.employees[s].id==e)return t.employees[s];return{}}}}});const m={class:"auth d-flex flex-wrap justify-content-center"},f={class:"col col-md-4 mt-5 p-5 bg-white shadow-sm"},_={class:"d-flex justify-content-center"},w=["src"],g={class:"row mt-3"},b={class:"row mt-3"},y={class:"row mt-3"},v={class:"row mt-3"};function S(t,e,s,n,l,i){return(0,o.wg)(),(0,o.iD)("div",m,[(0,o._)("form",f,[(0,o._)("div",_,[(0,o._)("img",{src:t.logo,alt:"logo"},null,8,w)]),(0,o._)("div",g,[(0,o.wy)((0,o._)("input",{name:"email",type:"text",class:"form-control",placeholder:"Е-мейл","onUpdate:modelValue":e[0]||(e[0]=e=>t.email=e)},null,512),[[a.nr,t.email]])]),(0,o._)("div",b,[(0,o.wy)((0,o._)("input",{name:"org_password",type:"password",class:"form-control",placeholder:"Пароль организации","onUpdate:modelValue":e[1]||(e[1]=e=>t.password=e)},null,512),[[a.nr,t.password]])]),(0,o._)("div",y,[(0,o.wy)((0,o._)("input",{autocomplete:"false",name:"owner_pin",type:"password",class:"form-control",placeholder:"PIN владельца","onUpdate:modelValue":e[2]||(e[2]=e=>t.pin=e)},null,512),[[a.nr,t.pin]])]),(0,o._)("div",v,[(0,o._)("button",{class:"btn btn-outline-primary",onClick:e[3]||(e[3]=(0,a.iM)(((...t)=>i.signIn&&i.signIn(...t)),["prevent"]))}," Вход ")])])])}var $=s.p+"img/logo.5888dcdd.png",O=s(6265),k=s.n(O),T=k();T.defaults.baseURL="http://141.8.199.108/api/v1";var x=T,W={name:"AuthView",data:()=>({email:"",password:"",pin:"",logo:$}),methods:{async loadOutlets(){let{data:t}=await x({url:"/outlets",method:"get",headers:{Authorization:this.$store.state.orgJWT}});this.$store.commit("setOutlets",t.data)},async loadEployees(){let{data:t}=await x({url:"/employees",method:"get",headers:{Authorization:this.$store.state.orgJWT}});this.$store.commit("setEmployees",t.data)},async signIn(){let t;try{let t=await x({url:"/auth/signIn.Org",method:"post",data:{email:this.$data.email,password:this.$data.password}});this.$store.commit("setOrgJWT",t.data.data.token)}catch{return void alert("неверные данные для входа")}await this.loadEployees();for(let e=0;e<this.$store.state.employees.length;e++)if("owner"===this.$store.state.employees[e]["role"]){t=this.$store.state.employees[e]["id"];break}try{let e=await x({url:"/auth/signIn.Employee",method:"post",headers:{Authorization:this.$store.state.orgJWT},data:{id:t,password:this.$data.pin}});this.$store.commit("setEmplJWT",e.data.data.token),this.$store.commit("setAffiliate",e.data.data.affiliate)}catch{return void alert("ошибка при входе в аккаунт владельца")}await this.loadOutlets(),this.$router.push({name:"report"})}}};const z=(0,i.Z)(W,[["render",S]]);var J=z,L=s(7139);const U={class:"report d-flex flex-wrap flex-row justify-content-center"},A={class:"col col-9 d-flex justify-content-between bg-white p-2 m-1 m-md-3 shadow-sm"},D=["value"],E=(0,o._)("i",{class:"bi bi-arrow-repeat"},null,-1),j=[E];function I(t,e,s,n,l,i){const r=(0,o.up)("report-last-session");return(0,o.wg)(),(0,o.iD)("div",U,[(0,o._)("div",A,[(0,o.wy)((0,o._)("select",{class:"col-5 p-2",name:"outlets","onUpdate:modelValue":e[0]||(e[0]=e=>t.selectedOutlet=e),onChange:e[1]||(e[1]=(...t)=>i.changeOutlet&&i.changeOutlet(...t))},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.$store.state.outlets,((t,e)=>((0,o.wg)(),(0,o.iD)("option",{key:e,value:t.id},(0,L.zw)(t.name),9,D)))),128))],544),[[a.bM,t.selectedOutlet,void 0,{number:!0}]]),(0,o._)("button",{class:"btn btn-outline-dark",onClick:e[2]||(e[2]=(...t)=>i.reportOnLastSession&&i.reportOnLastSession(...t))},j)]),(0,o.Wm)(r,{lastSession:t.lastSession},null,8,["lastSession"])])}const P={class:"col col-md-9 d-flex flex-wrap bg-white p-2 m-1 p-md-3 m-md-3 shadow-sm"},B=(0,o._)("h6",{class:"col-12 text-center"},"Метрики по последней смене",-1),C={class:"col d-flex flex-column"},M=(0,o._)("i",{class:"bi bi-person-fill"},null,-1),R=(0,o.Uk)(" Сотрудник: "),V=(0,o._)("i",{class:"bi bi-bar-chart-line"},null,-1),Z=(0,o.Uk)(" Статус смены: "),H=(0,o._)("hr",null,null,-1),F=(0,o._)("i",{class:"bi bi-door-open"},null,-1),K=(0,o.Uk)(" Открыта: "),N=(0,o._)("i",{class:"bi bi-door-closed"},null,-1),Y=(0,o.Uk)(" Закрыта: "),q=(0,o._)("hr",null,null,-1),G=(0,o._)("i",{class:"bi bi-cash-coin"},null,-1),Q=(0,o.Uk)(" Наличные на момент открытия кассы: "),X=(0,o._)("i",{class:"bi bi-cash-coin"},null,-1),tt=(0,o.Uk)(" Наличные на момент закрытия кассы: "),et=(0,o._)("hr",null,null,-1),st=(0,o._)("i",{class:"bi bi-cart-check"},null,-1),at=(0,o.Uk)(" Кол-во чеков: "),ot=(0,o._)("i",{class:"bi bi-piggy-bank"},null,-1),nt=(0,o.Uk)(" Выручка: ");function lt(t,e,s,a,n,l){return(0,o.wg)(),(0,o.iD)("div",P,[B,(0,o._)("div",C,[(0,o._)("span",null,[M,R,(0,o._)("b",null,(0,L.zw)(t.$store.getters.getEmployeeByID(t.$props.lastSession.employee_id).name),1)]),(0,o._)("span",null,[V,Z,(0,o._)("b",null,(0,L.zw)("-"===s.lastSession.date_close?"открыта":"закрыта"),1)]),H,(0,o._)("span",null,[F,K,(0,o._)("b",null,(0,L.zw)(s.lastSession.date_open),1)]),(0,o._)("span",null,[N,Y,(0,o._)("b",null,(0,L.zw)(s.lastSession.date_close),1)]),q,(0,o._)("span",null,[G,Q,(0,o._)("b",null,(0,L.zw)(s.lastSession.cash_open),1)]),(0,o._)("span",null,[X,tt,(0,o._)("b",null,(0,L.zw)(s.lastSession.cash_close),1)]),et,(0,o._)("span",null,[st,at,(0,o._)("b",null,(0,L.zw)(s.lastSession.number_of_receipts),1)]),(0,o._)("span",null,[ot,nt,(0,o._)("b",null,(0,L.zw)((s.lastSession.cash_earned+s.lastSession.bank_earned).toFixed(2))+" ₽ ",1)])])])}var it={name:"ReportLastSession",props:{lastSession:{}}};const rt=(0,i.Z)(it,[["render",lt]]);var ut=rt,dt={name:"ReportView",components:{ReportLastSession:ut},data:()=>({selectedOutlet:0,outlets:[{id:0,name:"Загрузка..."}],lastSession:{id:0,cash_earned:0,bank_earned:0,number_of_receipts:0,cash_open:0,cash_close:0,date_open:0,date_close:0,employee_id:0,outlet_id:0}}),mounted(){this.loadOutlets(),this.reportOnLastSession()},watch:{lastSession:function(t){let e;this.lastSession=t,0===this.lastSession.date_open?this.lastSession.date_open="-":(e=new Date(this.lastSession.date_open),this.lastSession.date_open=`${e.toDateString()} ${e.getHours()}:${e.getMinutes()}`),0===this.lastSession.date_close?this.lastSession.date_close="-":(e=new Date(this.lastSession.date_close),this.lastSession.date_close=`${e.toDateString()} ${e.getHours()}:${e.getMinutes()}`)}},methods:{changeOutlet(){this.reportOnLastSession()},loadOutlets(){x({url:"/outlets",method:"get",headers:{Authorization:this.$store.state.orgJWT}}).then((t=>{this.$data.outlets=t.data.data,this.$data.selectedOutlet=t.data.data[0].id}))},reportOnLastSession(){x({url:"/sessions.Last",params:{outlet_id:this.$data.selectedOutlet},method:"get",headers:{Authorization:this.$store.state.emplJWT}}).then((t=>{this.$data.lastSession=t.data.data,0===this.$data.lastSession.date_close&&0!=this.$data.lastSession.date_open&&(this.calculateReceiptsByLastSession(),this.calculateProfitByLastSession())}))},calculateReceiptsByLastSession(){x({url:"/orderInfo",params:{session_id:this.$data.lastSession.id},method:"get",headers:{Authorization:this.$store.state.emplJWT}}).then((t=>{this.$data.lastSession.number_of_receipts=t.data.data.length}))},calculateProfitByLastSession(){x({url:"/orderList.Calc",params:{session_id:this.$data.lastSession.id},method:"get",headers:{Authorization:this.$store.state.emplJWT}}).then((t=>{this.$data.lastSession.bank_earned=t.data.data.total}))}}};const ct=(0,i.Z)(dt,[["render",I]]);var pt=ct;const ht=[{path:"/",name:"auth",component:J},{path:"/report",name:"report",component:pt}],mt=(0,c.p7)({history:(0,c.PO)("/"),routes:ht});mt.beforeEach((t=>{if("/"!=t.fullPath&&""===h.state.emplJWT)return mt.push({name:"auth"})}));var ft=mt;(0,a.ri)(d).use(h).use(ft).mount("#app")}},e={};function s(a){var o=e[a];if(void 0!==o)return o.exports;var n=e[a]={exports:{}};return t[a](n,n.exports,s),n.exports}s.m=t,function(){var t=[];s.O=function(e,a,o,n){if(!a){var l=1/0;for(d=0;d<t.length;d++){a=t[d][0],o=t[d][1],n=t[d][2];for(var i=!0,r=0;r<a.length;r++)(!1&n||l>=n)&&Object.keys(s.O).every((function(t){return s.O[t](a[r])}))?a.splice(r--,1):(i=!1,n<l&&(l=n));if(i){t.splice(d--,1);var u=o();void 0!==u&&(e=u)}}return e}n=n||0;for(var d=t.length;d>0&&t[d-1][2]>n;d--)t[d]=t[d-1];t[d]=[a,o,n]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){s.p="/"}(),function(){var t={143:0};s.O.j=function(e){return 0===t[e]};var e=function(e,a){var o,n,l=a[0],i=a[1],r=a[2],u=0;if(l.some((function(e){return 0!==t[e]}))){for(o in i)s.o(i,o)&&(s.m[o]=i[o]);if(r)var d=r(s)}for(e&&e(a);u<l.length;u++)n=l[u],s.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return s.O(d)},a=self["webpackChunk_7era_pos_webpanel"]=self["webpackChunk_7era_pos_webpanel"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=s.O(void 0,[998],(function(){return s(3812)}));a=s.O(a)})();
//# sourceMappingURL=app.16ec992b.js.map