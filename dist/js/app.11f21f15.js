(function(){"use strict";var e={8463:function(e,t,s){var a=s(9242),o=s(3396);const n={class:"container-fluid container-md"};function l(e,t){const s=(0,o.up)("router-view");return(0,o.wg)(),(0,o.iD)("div",n,[(0,o.Wm)(s)])}var i=s(89);const r={},d=(0,i.Z)(r,[["render",l]]);var c=d,u=s(678),p=s(65),h=(0,p.MT)({state:{orgJWT:"",emplJWT:"",isAffiliate:!1,outlets:[{id:0,name:"loading..."}],employees:[]},mutations:{setOrgJWT(e,t){e.orgJWT=t},setEmplJWT(e,t){e.emplJWT=t},setAffiliate(e,t){e.isAffiliate=t},setOutlets(e,t){e.outlets=t},setEmployees(e,t){e.employees=t}},getters:{getEmployeeByID(e){return t=>{for(let s=0;s<e.employees.length;s++)if(e.employees[s].id==t)return e.employees[s];return{}}}}});const m={class:"auth d-flex flex-wrap justify-content-center"},_={class:"col col-md-4 mt-5 p-5 bg-white shadow-sm"},f={class:"d-flex justify-content-center"},b=["src"],g={class:"row mt-3"},w={class:"row mt-3"},v={class:"row mt-3"},y={class:"row mt-3"};function $(e,t,s,n,l,i){return(0,o.wg)(),(0,o.iD)("div",m,[(0,o._)("form",_,[(0,o._)("div",f,[(0,o._)("img",{src:e.logo,alt:"logo"},null,8,b)]),(0,o._)("div",g,[(0,o.wy)((0,o._)("input",{autocomplete:"on",type:"text",class:"form-control",placeholder:"Е-мейл","onUpdate:modelValue":t[0]||(t[0]=t=>e.email=t)},null,512),[[a.nr,e.email,void 0,{trim:!0}]])]),(0,o._)("div",w,[(0,o.wy)((0,o._)("input",{autocomplete:"on",type:"password",class:"form-control",placeholder:"Пароль организации","onUpdate:modelValue":t[1]||(t[1]=t=>e.password=t)},null,512),[[a.nr,e.password,void 0,{trim:!0}]])]),(0,o._)("div",v,[(0,o.wy)((0,o._)("input",{autocomplete:"on",class:"form-control",placeholder:"PIN владельца","onUpdate:modelValue":t[2]||(t[2]=t=>e.securepin=t),onKeyup:[t[3]||(t[3]=(...e)=>i.enterPIN&&i.enterPIN(...e)),t[4]||(t[4]=(0,a.D2)(((...e)=>i.delPIN&&i.delPIN(...e)),["delete"]))],maxlength:"6"},null,544),[[a.nr,e.securepin,void 0,{trim:!0}]])]),(0,o._)("div",y,[(0,o._)("button",{class:"btn btn-outline-primary",onClick:t[5]||(t[5]=(0,a.iM)(((...e)=>i.signIn&&i.signIn(...e)),["prevent"]))}," Вход ")])])])}var S=s.p+"img/logo.5888dcdd.png",O=s(6265),k=s.n(O),D=k();D.defaults.baseURL=localStorage.getItem("dev")?"http://localhost:80/api/v1":"http://141.8.199.108/api/v1";var x=D,I={name:"AuthView",data:()=>({email:"",password:"",pin:"",securepin:"",logo:S}),methods:{async loadOutlets(){let{data:e}=await x({url:"/outlets",method:"get",headers:{Authorization:this.$store.state.orgJWT}});this.$store.commit("setOutlets",e.data)},async loadEployees(){let{data:e}=await x({url:"/employees",method:"get",headers:{Authorization:this.$store.state.orgJWT}});this.$store.commit("setEmployees",e.data)},async signIn(){let e;try{let e=await x({url:"/auth/signIn.Org",method:"post",data:{email:this.$data.email,password:this.$data.password}});this.$store.commit("setOrgJWT",e.data.data.token)}catch{return void alert("неверные данные для входа")}await this.loadEployees();for(let t=0;t<this.$store.state.employees.length;t++)if("owner"===this.$store.state.employees[t]["role"]){e=this.$store.state.employees[t]["id"];break}try{let t=await x({url:"/auth/signIn.Employee",method:"post",headers:{Authorization:this.$store.state.orgJWT},data:{id:e,password:this.$data.pin}});this.$store.commit("setEmplJWT",t.data.data.token),this.$store.commit("setAffiliate",t.data.data.affiliate)}catch{return void alert("ошибка при входе в аккаунт владельца")}await this.loadOutlets(),this.$router.push({name:"report"})},enterPIN(e){this.$data.pin.length<6&&(this.$data.pin+=e.target.value.slice(-1),this.$data.securepin="*".repeat(this.$data.pin.length))},delPIN(){this.$data.pin="",this.$data.securepin=""}}};const W=(0,i.Z)(I,[["render",$]]);var z=W,T=s(7139);const U={class:"report d-flex flex-wrap justify-content-center"},E={class:"col-12 col-md-9 d-flex justify-content-between bg-white p-2 m-1 m-md-3 shadow-sm"},J=["value"],P=(0,o._)("i",{class:"bi bi-arrow-repeat"},null,-1),L=[P];function A(e,t,s,n,l,i){const r=(0,o.up)("report-last-session"),d=(0,o.up)("report-on-days");return(0,o.wg)(),(0,o.iD)("div",U,[(0,o._)("div",E,[(0,o.wy)((0,o._)("select",{class:"col-5 p-2",name:"outlets","onUpdate:modelValue":t[0]||(t[0]=t=>e.selectedOutlet=t),onChange:t[1]||(t[1]=(...e)=>i.changeOutlet&&i.changeOutlet(...e))},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.$store.state.outlets,((e,t)=>((0,o.wg)(),(0,o.iD)("option",{key:t,value:e.id},(0,T.zw)(e.name),9,J)))),128))],544),[[a.bM,e.selectedOutlet,void 0,{number:!0}]]),(0,o._)("button",{class:"btn btn-outline-dark",onClick:t[2]||(t[2]=(...e)=>i.reportOnLastSession&&i.reportOnLastSession(...e))},L)]),(0,o.Wm)(r,{lastSession:e.lastSession},null,8,["lastSession"]),(0,o.Wm)(d,{selectedOutlet:e.selectedOutlet},null,8,["selectedOutlet"])])}const C={class:"col-12 col-md-9 d-flex flex-wrap bg-white p-2 m-1 p-md-3 m-md-3 shadow-sm"},j=(0,o._)("h6",{class:"col-12 text-center"},"Метрики по последней смене",-1),B={class:"col d-flex flex-column"},M=(0,o._)("i",{class:"bi bi-person-fill"},null,-1),R=(0,o.Uk)(" Сотрудник: "),N=(0,o._)("i",{class:"bi bi-bar-chart-line"},null,-1),V=(0,o.Uk)(" Статус смены: "),Z=(0,o._)("hr",null,null,-1),H=(0,o._)("i",{class:"bi bi-door-open"},null,-1),K=(0,o.Uk)(" Открыта: "),F=(0,o._)("i",{class:"bi bi-door-closed"},null,-1),Y=(0,o.Uk)(" Закрыта: "),G=(0,o._)("hr",null,null,-1),q=(0,o._)("i",{class:"bi bi-cash-coin"},null,-1),Q=(0,o.Uk)(" Нал. на момент открытия: "),X=(0,o._)("i",{class:"bi bi-cash-coin"},null,-1),ee=(0,o.Uk)(" Нал. на момент закрытия: "),te=(0,o._)("hr",null,null,-1),se=(0,o._)("i",{class:"bi bi-cart-check"},null,-1),ae=(0,o.Uk)(" Кол-во чеков: "),oe=(0,o._)("i",{class:"bi bi-piggy-bank"},null,-1),ne=(0,o.Uk)(" Выручка: ");function le(e,t,s,a,n,l){return(0,o.wg)(),(0,o.iD)("div",C,[j,(0,o._)("div",B,[(0,o._)("span",null,[M,R,(0,o._)("b",null,(0,T.zw)(e.$store.getters.getEmployeeByID(e.$props.lastSession.employee_id).name),1)]),(0,o._)("span",null,[N,V,(0,o._)("b",null,(0,T.zw)("-"===s.lastSession.date_close?"открыта":"закрыта"),1)]),Z,(0,o._)("span",null,[H,K,(0,o._)("b",null,(0,T.zw)(s.lastSession.date_open),1)]),(0,o._)("span",null,[F,Y,(0,o._)("b",null,(0,T.zw)(s.lastSession.date_close),1)]),G,(0,o._)("span",null,[q,Q,(0,o._)("b",null,(0,T.zw)(s.lastSession.cash_open),1)]),(0,o._)("span",null,[X,ee,(0,o._)("b",null,(0,T.zw)(s.lastSession.cash_close),1)]),te,(0,o._)("span",null,[se,ae,(0,o._)("b",null,(0,T.zw)(s.lastSession.number_of_receipts),1)]),(0,o._)("span",null,[oe,ne,(0,o._)("b",null,(0,T.zw)((s.lastSession.cash_earned+s.lastSession.bank_earned).toFixed(2))+" ₽ ",1)])])])}var ie={name:"ReportLastSession",props:{lastSession:{}}};const re=(0,i.Z)(ie,[["render",le]]);var de=re;const ce=e=>((0,o.dD)("data-v-5a1bd594"),e=e(),(0,o.Cn)(),e),ue={class:"col-12 col-md-9 d-flex flex-wrap bg-white p-2 m-1 p-md-3 m-md-3 shadow-sm"},pe=ce((()=>(0,o._)("h6",{class:"col-12 text-center"},"Метрики по дням",-1))),he={class:"col-12 d-flex justify-content-center m-2"},me=ce((()=>(0,o._)("div",{class:"col-12"},[(0,o._)("p",{class:"text-muted text-center"},[(0,o._)("i",{class:"bi bi-info-circle"}),(0,o.Uk)(" Нажмити на смену, чтобы увидеть детальную информацию "),(0,o._)("br"),(0,o._)("i",{class:"bi bi-exclamation-triangle"}),(0,o.Uk)(" Открытые в данный момент смены не имеют детальной информации ")])],-1))),_e={class:"col-12 d-flex flex-wrap",id:"sessions-list"},fe={class:"table table-hover table-bordered"},be=ce((()=>(0,o._)("thead",{class:"bg-white"},[(0,o._)("tr",null,[(0,o._)("th",{scope:"col"},[(0,o._)("i",{class:"bi bi-list-ol"}),(0,o.Uk)(" ID смены ")]),(0,o._)("th",{scope:"col"},[(0,o._)("i",{class:"bi bi-person-fill"}),(0,o.Uk)(" Сотрудник ")]),(0,o._)("th",{scope:"col"},[(0,o._)("i",{class:"bi bi-cash-coin"}),(0,o.Uk)(" Выручка за смену ")]),(0,o._)("th",{scope:"col"},[(0,o._)("i",{class:"bi bi-cart-check"}),(0,o.Uk)(" Кол-во чеков ")])])],-1))),ge=["onClick"],we={scope:"row"};function ve(e,t,s,a,n,l){return(0,o.wg)(),(0,o.iD)("div",ue,[pe,(0,o._)("div",he,[(0,o._)("input",{type:"date",class:"p-1",onChange:t[0]||(t[0]=(...e)=>l.chooseDate&&l.chooseDate(...e))},null,32)]),me,(0,o._)("div",_e,[(0,o._)("table",fe,[be,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.sessions,((t,s)=>((0,o.wg)(),(0,o.iD)("tr",{key:s,onClick:e=>l.alertMoreInfo(s)},[(0,o._)("th",we,(0,T.zw)(t.id),1),(0,o._)("td",null,(0,T.zw)(e.$store.getters.getEmployeeByID(t.employee_id).name||"(удалён)"),1),(0,o._)("td",null,(0,T.zw)(t.cash_earned+t.bank_earned)+" ₽ ",1),(0,o._)("td",null,(0,T.zw)(t.number_of_receipts),1)],8,ge)))),128))])])])])}var ye={name:"ReportOnDays",data:()=>({dateStart:0,dateEnd:0,sessions:[{id:0,bank_earned:0,cash_close:0,cash_earned:0,cash_open:0,date_close:0,date_open:0,employee_id:0,number_of_receipts:0,outlet_id:0}]}),props:["selectedOutlet"],watch:{selectedOutlet(){0!=this.$data.dateStart&&this.loadSessionsWithPeriod()}},methods:{alertMoreInfo(e){let t=this.$data.sessions[e],s=`Cессия: id${t.id}\nCотрудник: id${t.employee_id}, (${this.$store.getters.getEmployeeByID(t.employee_id).name||"удалён"})\n\nКол-во чеков: ${t.number_of_receipts}\nЗаработано оплатой наличными: ${t.cash_earned} ₽\nЗаработано оплатой по карте: ${t.bank_earned} ₽\n\nДата открытия: ${new Date(t.date_open).toString()}\nДата закрытия: ${new Date(t.date_close).toString()}\n`;alert(s)},chooseDate(e){let t=Date.parse(e.target.value);this.$data.dateStart=t,this.$data.dateEnd=t+864e5,this.loadSessionsWithPeriod()},loadSessionsWithPeriod(){x({url:"/sessions",method:"GET",headers:{Authorization:this.$store.state.emplJWT},params:{start:this.$data.dateStart,end:this.$data.dateEnd,outlet_id:this.$props.selectedOutlet}}).then((({data:e})=>{console.log(e),this.$data.sessions=e.data}))}}};const $e=(0,i.Z)(ye,[["render",ve],["__scopeId","data-v-5a1bd594"]]);var Se=$e,Oe={name:"ReportView",components:{ReportLastSession:de,ReportOnDays:Se},data:()=>({selectedOutlet:0,outlets:[{id:0,name:"Загрузка..."}],lastSession:{id:0,cash_earned:0,bank_earned:0,number_of_receipts:0,cash_open:0,cash_close:0,date_open:0,date_close:0,employee_id:0,outlet_id:0}}),mounted(){this.loadOutlets(),this.reportOnLastSession()},watch:{lastSession:function(e){let t;this.lastSession=e,0===this.lastSession.date_open?this.lastSession.date_open="-":(t=new Date(this.lastSession.date_open),this.lastSession.date_open=`${t.toDateString()} ${t.getHours()}:${t.getMinutes()}`),0===this.lastSession.date_close?this.lastSession.date_close="-":(t=new Date(this.lastSession.date_close),this.lastSession.date_close=`${t.toDateString()} ${t.getHours()}:${t.getMinutes()}`)}},methods:{changeOutlet(){this.reportOnLastSession()},loadOutlets(){x({url:"/outlets",method:"get",headers:{Authorization:this.$store.state.orgJWT}}).then((e=>{this.$data.outlets=e.data.data,this.$data.selectedOutlet=e.data.data[0].id}))},reportOnLastSession(){x({url:"/sessions.Last",params:{outlet_id:this.$data.selectedOutlet},method:"get",headers:{Authorization:this.$store.state.emplJWT}}).then((e=>{this.$data.lastSession=e.data.data,0===this.$data.lastSession.date_close&&0!=this.$data.lastSession.date_open&&(this.calculateReceiptsByLastSession(),this.calculateProfitByLastSession())}))},calculateReceiptsByLastSession(){x({url:"/orderInfo",params:{session_id:this.$data.lastSession.id},method:"get",headers:{Authorization:this.$store.state.emplJWT}}).then((e=>{this.$data.lastSession.number_of_receipts=e.data.data.length}))},calculateProfitByLastSession(){x({url:"/orderList.Calc",params:{session_id:this.$data.lastSession.id},method:"get",headers:{Authorization:this.$store.state.emplJWT}}).then((e=>{this.$data.lastSession.bank_earned=e.data.data.total}))}}};const ke=(0,i.Z)(Oe,[["render",A]]);var De=ke;const xe=[{path:"/",name:"auth",component:z},{path:"/report",name:"report",component:De}],Ie=(0,u.p7)({history:(0,u.PO)("/"),routes:xe});Ie.beforeEach((e=>{if("/"!=e.fullPath&&""===h.state.emplJWT)return Ie.push({name:"auth"})}));var We=Ie;(0,a.ri)(c).use(h).use(We).mount("#app"),window.remode=function(){localStorage.getItem("dev")?localStorage.removeItem("dev"):localStorage.setItem("dev",!0),window.location.reload()},localStorage.getItem("dev")&&console.log("used dev mode")}},t={};function s(a){var o=t[a];if(void 0!==o)return o.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,s),n.exports}s.m=e,function(){var e=[];s.O=function(t,a,o,n){if(!a){var l=1/0;for(c=0;c<e.length;c++){a=e[c][0],o=e[c][1],n=e[c][2];for(var i=!0,r=0;r<a.length;r++)(!1&n||l>=n)&&Object.keys(s.O).every((function(e){return s.O[e](a[r])}))?a.splice(r--,1):(i=!1,n<l&&(l=n));if(i){e.splice(c--,1);var d=o();void 0!==d&&(t=d)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[a,o,n]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.p="/"}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,n,l=a[0],i=a[1],r=a[2],d=0;if(l.some((function(t){return 0!==e[t]}))){for(o in i)s.o(i,o)&&(s.m[o]=i[o]);if(r)var c=r(s)}for(t&&t(a);d<l.length;d++)n=l[d],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(c)},a=self["webpackChunk_7era_pos_webpanel"]=self["webpackChunk_7era_pos_webpanel"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[998],(function(){return s(8463)}));a=s.O(a)})();
//# sourceMappingURL=app.11f21f15.js.map