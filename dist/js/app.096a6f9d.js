(function(){"use strict";var t={8009:function(t,e,s){var a=s(9242),n=s(3396);const o={class:"container"};function l(t,e){const s=(0,n.up)("router-view");return(0,n.wg)(),(0,n.iD)("div",o,[(0,n.Wm)(s)])}var i=s(89);const r={},u=(0,i.Z)(r,[["render",l]]);var d=u,c=s(678),p=s(65),h=(0,p.MT)({state:{orgJWT:"",emplJWT:"",isAffiliate:!1},mutations:{setOrgJWT(t,e){t.orgJWT=e},setEmplJWT(t,e){t.emplJWT=e},setAffiliate(t,e){t.isAffiliate=e}}});const m={class:"auth d-flex flex-wrap justify-content-center"},f=(0,n._)("h1",{class:"col-12 text-center p-2"},"7Era POS System",-1),_={class:"col col-md-4 mt-3 p-4 bg-white"},w={class:"row mt-3"},g={class:"row mt-3"},v={class:"row mt-3"},b={class:"row mt-3"};function S(t,e,s,o,l,i){return(0,n.wg)(),(0,n.iD)("div",m,[f,(0,n._)("form",_,[(0,n._)("div",w,[(0,n.wy)((0,n._)("input",{name:"email",type:"text",class:"form-control",placeholder:"Е-мейл","onUpdate:modelValue":e[0]||(e[0]=e=>t.email=e)},null,512),[[a.nr,t.email]])]),(0,n._)("div",g,[(0,n.wy)((0,n._)("input",{name:"org_password",type:"password",class:"form-control",placeholder:"Пароль организации","onUpdate:modelValue":e[1]||(e[1]=e=>t.password=e)},null,512),[[a.nr,t.password]])]),(0,n._)("div",v,[(0,n.wy)((0,n._)("input",{autocomplete:"false",name:"owner_pin",type:"password",class:"form-control",placeholder:"PIN владельца","onUpdate:modelValue":e[2]||(e[2]=e=>t.pin=e)},null,512),[[a.nr,t.pin]])]),(0,n._)("div",b,[(0,n._)("button",{class:"btn btn-primary",onClick:e[3]||(e[3]=(0,a.iM)(((...t)=>i.signIn&&i.signIn(...t)),["prevent"]))}," Вход ")])])])}var y=s(6265),O=s.n(y),$=O();$.defaults.baseURL="http://141.8.199.108/api/v1";var k=$,T={name:"AuthView",data:()=>({email:"",password:"",pin:""}),methods:{async signIn(){let t;try{let t=await k({url:"/auth/signIn.Org",method:"post",data:{email:this.$data.email,password:this.$data.password}});this.$store.commit("setOrgJWT",t.data.data.token)}catch{return void alert("неверные данные для входа")}try{let e=await k({url:"/employees",method:"get",headers:{Authorization:this.$store.state.orgJWT},data:{email:this.$data.email,password:this.$data.password}});for(let s=0;s<e.data.data.length;s++)if("owner"===e.data.data[s]["role"]){t=e.data.data[s]["id"];break}}catch{return void alert("ошибка получения списка сотрудников")}try{let e=await k({url:"/auth/signIn.Employee",method:"post",headers:{Authorization:this.$store.state.orgJWT},data:{id:t,password:this.$data.pin}});this.$store.commit("setEmplJWT",e.data.data.token),this.$store.commit("setAffiliate",e.data.data.affiliate),console.info("success auth!")}catch{return void alert("ошибка при входе в аккаунт владельца")}this.$router.push({name:"report"})}}};const x=(0,i.Z)(T,[["render",S]]);var W=x,z=s(7139);const J={class:"report d-flex flex-column"},L={class:"col d-flex justify-content-between bg-white p-3 m-2"},A=["value"],D={class:"col d-flex flex-wrap bg-white p-3 m-2"},U=(0,n._)("h6",{class:"col-12 text-center"},"Метрики по последней сессии",-1),j={class:"col d-flex flex-column"},I=(0,n.Uk)(" ID сотрудника: "),P=(0,n.Uk)(" Статус: "),C=(0,n._)("hr",null,null,-1),E=(0,n._)("hr",null,null,-1),M=(0,n._)("hr",null,null,-1),V=(0,n.Uk)(" Кол-во чеков: "),B=(0,n.Uk)(" Выручка: ");function R(t,e,s,o,l,i){return(0,n.wg)(),(0,n.iD)("div",J,[(0,n._)("div",L,[(0,n.wy)((0,n._)("select",{class:"col-3 p-2",name:"outlets","onUpdate:modelValue":e[0]||(e[0]=e=>t.selectedOutlet=e),onChange:e[1]||(e[1]=(...t)=>i.changeOutlet&&i.changeOutlet(...t))},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(t.outlets,((t,e)=>((0,n.wg)(),(0,n.iD)("option",{key:e,value:t.id},(0,z.zw)(t.name),9,A)))),128))],544),[[a.bM,t.selectedOutlet,void 0,{number:!0}]]),(0,n._)("button",{class:"btn btn-outline-primary",onClick:e[2]||(e[2]=(...t)=>i.reportOnLastSession&&i.reportOnLastSession(...t))}," Обновить ")]),(0,n._)("div",D,[U,(0,n._)("div",j,[(0,n._)("span",null,[I,(0,n._)("b",null,(0,z.zw)(t.lastSession.employee_id),1)]),(0,n._)("span",null,[P,(0,n._)("b",null,(0,z.zw)(0===t.lastSession.date_close?"открыта":"закрыта"),1)]),C,(0,n._)("span",null," Время открытия: "+(0,z.zw)(t.lastSession.date_open),1),(0,n._)("span",null," Время закрытия: "+(0,z.zw)(t.lastSession.date_close),1),E,(0,n._)("span",null," Наличные на момент открытия кассы: "+(0,z.zw)(t.lastSession.cash_open),1),(0,n._)("span",null," Наличные на момент закрытия кассы: "+(0,z.zw)(t.lastSession.cash_close),1),M,(0,n._)("span",null,[V,(0,n._)("b",null,(0,z.zw)(t.lastSession.number_of_receipts),1)]),(0,n._)("span",null,[B,(0,n._)("b",null,(0,z.zw)((t.lastSession.cash_earned+t.lastSession.bank_earned).toFixed(2))+" ₽ ",1)])])])])}var H={name:"ReportView",data:()=>({reloadKey:!1,selectedOutlet:0,outlets:[{id:0,name:"Загрузка..."}],lastSession:{id:0,cash_earned:0,bank_earned:0,number_of_receipts:0,cash_open:0,cash_close:0,date_open:0,date_close:0,employee_id:0,outlet_id:0}}),mounted(){this.loadOutlets(),this.reportOnLastSession()},watch:{lastSession:function(t){let e;this.lastSession=t,e=new Date(this.lastSession.date_open),this.lastSession.date_open=`${e.toDateString()} ${e.getHours()}:${e.getMinutes()}`,0===this.lastSession.date_close?this.lastSession.date_close="-":(e=new Date(this.lastSession.date_close),this.lastSession.date_close=`${e.toDateString()} ${e.getHours()}:${e.getMinutes()}`)}},methods:{changeOutlet(){this.reportOnLastSession()},loadOutlets(){k({url:"/outlets",method:"get",headers:{Authorization:this.$store.state.orgJWT}}).then((t=>{this.$data.outlets=t.data.data,this.$data.selectedOutlet=t.data.data[0].id}))},reportOnLastSession(){k({url:"/sessions.Last",params:{outlet_id:this.$data.selectedOutlet},method:"get",headers:{Authorization:this.$store.state.emplJWT}}).then((t=>{this.$data.lastSession=t.data.data,0===this.$data.lastSession.date_close&&(this.calculateReceiptsByLastSession(),this.calculateProfitByLastSession())}))},calculateReceiptsByLastSession(){k({url:"/orderInfo",params:{session_id:this.$data.lastSession.id},method:"get",headers:{Authorization:this.$store.state.emplJWT}}).then((t=>{this.$data.lastSession.number_of_receipts=t.data.data.length}))},calculateProfitByLastSession(){k({url:"/orderList.Calc",params:{session_id:this.$data.lastSession.id},method:"get",headers:{Authorization:this.$store.state.emplJWT}}).then((t=>{this.$data.lastSession.bank_earned=t.data.data.total}))}}};const Z=(0,i.Z)(H,[["render",R]]);var F=Z;const K=[{path:"/",name:"auth",component:W},{path:"/report",name:"report",component:F}],N=(0,c.p7)({history:(0,c.PO)("/"),routes:K});N.beforeEach((t=>{if("/"!=t.fullPath&&""===h.state.emplJWT)return N.push({name:"auth"})}));var Y=N;(0,a.ri)(d).use(h).use(Y).mount("#app")}},e={};function s(a){var n=e[a];if(void 0!==n)return n.exports;var o=e[a]={exports:{}};return t[a](o,o.exports,s),o.exports}s.m=t,function(){var t=[];s.O=function(e,a,n,o){if(!a){var l=1/0;for(d=0;d<t.length;d++){a=t[d][0],n=t[d][1],o=t[d][2];for(var i=!0,r=0;r<a.length;r++)(!1&o||l>=o)&&Object.keys(s.O).every((function(t){return s.O[t](a[r])}))?a.splice(r--,1):(i=!1,o<l&&(l=o));if(i){t.splice(d--,1);var u=n();void 0!==u&&(e=u)}}return e}o=o||0;for(var d=t.length;d>0&&t[d-1][2]>o;d--)t[d]=t[d-1];t[d]=[a,n,o]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={143:0};s.O.j=function(e){return 0===t[e]};var e=function(e,a){var n,o,l=a[0],i=a[1],r=a[2],u=0;if(l.some((function(e){return 0!==t[e]}))){for(n in i)s.o(i,n)&&(s.m[n]=i[n]);if(r)var d=r(s)}for(e&&e(a);u<l.length;u++)o=l[u],s.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return s.O(d)},a=self["webpackChunk_7era_pos_webpanel"]=self["webpackChunk_7era_pos_webpanel"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=s.O(void 0,[998],(function(){return s(8009)}));a=s.O(a)})();
//# sourceMappingURL=app.096a6f9d.js.map